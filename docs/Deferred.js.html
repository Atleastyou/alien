<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Source: libs/Deferred.js - Alien documents</title>

    <link type="text/css" rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
    <link type="text/css" rel="stylesheet" href="/static/styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="/static/css/docs.css">
</head>

<body>


<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
	    <div class="navbar-header">
	        <a class="navbar-brand" href="index.html">Alien documents</a>
	    </div>
	    <nav role="navigation">
			<ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="jsonp.html">core/communication/jsonp</a></li>
<li><a href="xhr.html">core/communication/xhr</a></li>
<li><a href="animation.html">core/dom/animation</a></li>
<li><a href="attribute.html">core/dom/attribute</a></li>
<li><a href="modification.html">core/dom/modification</a></li>
<li><a href="selector.html">core/dom/selector</a></li>
<li><a href="base.html">core/event/base</a></li>
<li><a href="drag.html">core/event/drag</a></li>
<li><a href="ready.html">core/event/ready</a></li>
<li><a href="touch.html">core/event/touch</a></li>
<li><a href="wheel.html">core/event/wheel</a></li>
<li><a href="compatible.html">core/navigator/compatible</a></li>
<li><a href="hashbang.html">core/navigator/hashbang</a></li>
<li><a href="querystring.html">core/navigator/querystring</a></li>
<li><a href="shell.html">core/navigator/shell</a></li>
<li><a href="ua.html">core/navigator/ua</a></li>
<li><a href="DDB.html">libs/DDB</a></li>
<li><a href="Deferred.html">libs/Deferred</a></li>
<li><a href="Emitter.html">libs/Emitter</a></li>
<li><a href="Template.html">libs/Template</a></li>
<li><a href="upload.html">parent/upload</a></li>
<li><a href="Banner.html">ui/Banner</a></li>
<li><a href="Dialog.html">ui/Dialog</a></li>
<li><a href="Msg.html">ui/Msg</a></li>
<li><a href="Pagination.html">ui/Pagination</a></li>
<li><a href="Scrollbar.html">ui/Scrollbar</a></li>
<li><a href="Tooltip.html">ui/Tooltip</a></li>
<li><a href="class.html">util/class</a></li>
<li><a href="data.html">util/data</a></li>
<li><a href="date.html">util/date</a></li>
<li><a href="easing.html">util/easing</a></li>
<li><a href="Pagination_.html">util/Pagination</a></li>
<li><a href="Validate.html">util/Validate</a></li>
</ul>
</li>
</ul>

			<ul class="nav navbar-nav navbar-right">
                <li><a href="/">Alien home</a></li>
            </ul>
	    </nav>
  </div>
</div>


<div id="main">


	

	    <div class="main">
	        <nav id="docs-sidebar">
	            

	            <ul class="nav sidebar-list">
	                

	                

	                

	                
	            </ul>
	        </nav>

	        <section id="docs-content">
	            <div class="content">
		            <h1 class="page-title">Source: libs/Deferred.js</h1>

		            


    

<pre class="prettyprint source"><code>/*!
 * Deferred.js
 * @author ydr.me
 * @create 2014-10-09 15:31
 */


define(function (require, exports, module) {
    /**
     * @module libs/Deferred
     * @requires util/class
     * @requires util/data
     */
    'use strict';

    var klass = require('../util/class.js');
    var data = require('../util/data.js');
    var noop = function () {
        // ignore
    };
    var Deferred = klass.create({
        constructor: function () {
            // 0       ->    1     ->         2
            // pending -> progress -> resolved/rejected
            var the = this;
            the.state = 'pending';
            the.code = 0;
            the.callbacks = {
                progress: [],
                resolved: [],
                rejected: [],
                always: []
            };
        },
        /**
         * 设置进度
         * @param {*} value 进度对象
         * @param {*} [context] 上下文
         * @returns {Deferred}
         * @chainable
         */
        notify: function (value, context) {
            var the = this;

            the._progress = value;

            data.each(the.callbacks.progress, function (index, cb) {
                cb.call(context, value);
            });

            return this;
        },
        /**
         * 成功回调
         * @param {Function} callback 回调函数
         * @returns {Deferred}
         * @chainable
         */
        done: function (callback) {
            this.callbacks.resolved.push(data.type(callback) === 'function' ? callback : noop);

            return this;
        },
        /**
         * 失败回调
         * @param {Function} callback 回调函数
         * @returns {Deferred}
         * @chainable
         */
        fail: function (callback) {
            this.callbacks.rejected.push(data.type(callback) === 'function' ? callback : noop);

            return this;
        },
        /**
         * 总是回调
         * @param {Function} doneCallback 成功回调
         * @param {Function} failCallback 失败回调
         * @returns {Deferred}
         */
        always: function (doneCallback, failCallback) {
            this.callbacks.rejected.push([
                    data.type(doneCallback) === 'function' ? doneCallback : noop,
                    data.type(failCallback) === 'function' ? failCallback : noop
            ]);

            return this;
        },
        /**
         * 进度回调
         * @param {Function} callback 回调函数
         * @returns {Deferred}
         */
        progress: function (callback) {
            this.callbacks.progress.push(data.type(callback) === 'function' ? callback : noop);

            return this;
        },
        /**
         * 改变当前结果为成功
         * @param {*} result 成功结果
         * @param {Object} [context] 失败上下文，默认为当前Deferred实例
         * @returns {Deferred}
         * @chainable
         */
        resolve: function (result, context) {
            var the = this;

            if (this.code > 1) {
                throw new Error('do not resolve after ' + the.status);
            }

            if (arguments.length === 0) {
                throw new Error('resolve require a result');
            }

            the.state = 'resolved';
            the.code = 2;

            data.each(the.callbacks.always, function (index, cbs) {
                cbs[0].call(context ? context : the, result);
                cbs[1].call(context ? context : the);
            });

            data.each(the.callbacks.resolved, function (index, cb) {
                cb.call(context ? context : the, result);
            });

            return the;
        },
        /**
         * 改变当前结果为失败
         * @param {*} reason 失败原因
         * @param {Object} [context] 失败上下文，默认为当前Deferred实例
         * @returns {Deferred}
         * @chainable
         */
        reject: function (reason, context) {
            var the = this;

            if (the.code > 1) {
                throw new Error('do not reject after ' + the.status);
            }

            if (arguments.length === 0) {
                throw new Error('reject require a reason');
            }

            the.state = 'rejected';
            the.code = 2;

            data.each(the.callbacks.always, function (index, cbs) {
                cbs[0].call(context ? context : the);
                cbs[1].call(context ? context : the, reason);
            });

            data.each(the.callbacks.rejected, function (index, cb) {
                cb.call(context ? context : the, reason);
            });

            return the;
        }
    });

    module.exports = Deferred;
});

</code></pre>






	            </div>
	        </section>
	    </div>

    


</div>

<script src="/static/js/jquery.1.10.min.js"> </script>
<script src="/static/js/prettify/prettify.js"> </script>
<script src="/static/js/prettify/lang-css.js"> </script>
<script> prettyPrint(); </script>
<script src="/static/js/linenumber.js"> </script>
<script src="/static/js/bootstrap.js"> </script>
<script src="/static/js/script.js"> </script>

</body>
</html>
