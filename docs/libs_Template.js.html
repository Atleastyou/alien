<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Source: libs/Template.js - Alien documents</title>

    <link type="text/css" rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
    <link type="text/css" rel="stylesheet" href="/static/styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="/static/css/docs.css">
</head>

<body>


<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
	    <div class="navbar-header">
	        <a class="navbar-brand" href="index.html">Alien documents</a>
	    </div>
	    <nav role="navigation">
			<ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="libs_Router.module_js.html">js</a></li>
<li><a href="module-core_communication_jsonp.html">core/communication/jsonp</a></li>
<li><a href="module-core_communication_upload.html">core/communication/upload</a></li>
<li><a href="module-core_communication_xhr.html">core/communication/xhr</a></li>
<li><a href="module-core_dom_animation.html">core/dom/animation</a></li>
<li><a href="module-core_dom_attribute.html">core/dom/attribute</a></li>
<li><a href="module-core_dom_canvas.html">core/dom/canvas</a></li>
<li><a href="module-core_dom_modification.html">core/dom/modification</a></li>
<li><a href="module-core_dom_see.html">core/dom/see</a></li>
<li><a href="module-core_dom_selector.html">core/dom/selector</a></li>
<li><a href="module-core_event_base.html">core/event/base</a></li>
<li><a href="module-core_event_drag.html">core/event/drag</a></li>
<li><a href="module-core_event_hotkey.html">core/event/hotkey</a></li>
<li><a href="module-core_event_ready.html">core/event/ready</a></li>
<li><a href="module-core_event_scroll.html">core/event/scroll</a></li>
<li><a href="module-core_event_touch.html">core/event/touch</a></li>
<li><a href="module-core_event_wheel.html">core/event/wheel</a></li>
<li><a href="module-core_navigator_compatible.html">core/navigator/compatible</a></li>
<li><a href="module-core_navigator_cookie.html">core/navigator/cookie</a></li>
<li><a href="module-core_navigator_hashbang.html">core/navigator/hashbang</a></li>
<li><a href="module-core_navigator_querystring.html">core/navigator/querystring</a></li>
<li><a href="module-core_navigator_shell.html">core/navigator/shell</a></li>
<li><a href="module-core_navigator_storage.html">core/navigator/storage</a></li>
<li><a href="module-core_navigator_ua.html">core/navigator/ua</a></li>
<li><a href="module-libs_Animation.html">libs/Animation</a></li>
<li><a href="module-libs_DDB.html">libs/DDB</a></li>
<li><a href="module-libs_Emitter.html">libs/Emitter</a></li>
<li><a href="module-libs_Pagination.html">libs/Pagination</a></li>
<li><a href="module-libs_Pjax.html">libs/Pjax</a></li>
<li><a href="module-libs_Queue.html">libs/Queue</a></li>
<li><a href="module-libs_Template.html">libs/Template</a></li>
<li><a href="module-libs_Validator.html">libs/Validator</a></li>
<li><a href="module-libs_Weixin.html">libs/Weixin</a></li>
<li><a href="module-parent_index.html">parent/index</a></li>
<li><a href="module-parent_keyframes.html">parent/keyframes</a></li>
<li><a href="module-ui_.html">ui/</a></li>
<li><a href="module-ui_Autoheight_.html">ui/Autoheight/</a></li>
<li><a href="module-ui_Banner_.html">ui/Banner/</a></li>
<li><a href="module-ui_DatetimePicker_.html">ui/DatetimePicker/</a></li>
<li><a href="module-ui_Dialog_.html">ui/Dialog/</a></li>
<li><a href="module-ui_Editor_.html">ui/Editor/</a></li>
<li><a href="module-ui_Imgclip_.html">ui/Imgclip/</a></li>
<li><a href="module-ui_Loading_.html">ui/Loading/</a></li>
<li><a href="module-ui_Mask_.html">ui/Mask/</a></li>
<li><a href="module-ui_Msg_.html">ui/Msg/</a></li>
<li><a href="module-ui_Pager_.html">ui/Pager/</a></li>
<li><a href="module-ui_Pagination_.html">ui/Pagination/</a></li>
<li><a href="module-ui_Popup_.html">ui/Popup/</a></li>
<li><a href="module-ui_Prettify_.html">ui/Prettify/</a></li>
<li><a href="module-ui_Range_.html">ui/Range/</a></li>
<li><a href="module-ui_Resize_.html">ui/Resize/</a></li>
<li><a href="module-ui_Scroll_.html">ui/Scroll/</a></li>
<li><a href="module-ui_Scrollbar_.html">ui/Scrollbar/</a></li>
<li><a href="module-ui_Scrollspy_.html">ui/Scrollspy/</a></li>
<li><a href="module-ui_Stickly_.html">ui/Stickly/</a></li>
<li><a href="module-ui_Tab_.html">ui/Tab/</a></li>
<li><a href="module-ui_Tooltip_.html">ui/Tooltip/</a></li>
<li><a href="module-ui_Validator_.html">ui/Validator/</a></li>
<li><a href="module-ui_Viewer_.html">ui/Viewer/</a></li>
<li><a href="module-ui_Window_.html">ui/Window/</a></li>
<li><a href="module-utils_allocation.html">utils/allocation</a></li>
<li><a href="module-utils_calendar.html">utils/calendar</a></li>
<li><a href="module-utils_canvas.html">utils/canvas</a></li>
<li><a href="module-utils_class.html">utils/class</a></li>
<li><a href="module-utils_controller.html">utils/controller</a></li>
<li><a href="module-utils_date.html">utils/date</a></li>
<li><a href="module-utils_dato.html">utils/dato</a></li>
<li><a href="module-utils_easing.html">utils/easing</a></li>
<li><a href="module-utils_hashbang.html">utils/hashbang</a></li>
<li><a href="module-utils_number.html">utils/number</a></li>
<li><a href="module-utils_querystring.html">utils/querystring</a></li>
<li><a href="module-utils_random.html">utils/random</a></li>
<li><a href="module-utils_selection.html">utils/selection</a></li>
<li><a href="module-utils_string.html">utils/string</a></li>
<li><a href="module-utils_typeis.html">utils/typeis</a></li>
<li><a href="module-utils_url.html">utils/url</a></li>
<li><a href="module-widgets_confirm.html">widgets/confirm</a></li>
<li><a href="module-widgets_prompt.html">widgets/prompt</a></li>
<li><a href="parent_marked-render-table.module_js.html">js</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="module-ui_Scroll_.html#~event:bottom">module:ui/Scroll/.bottom</a></li>
<li><a href="module-ui_Imgclip_.html#event:cancel">module:ui/Imgclip/.cancel</a></li>
<li><a href="module-ui_Tab_.html#~event:change">module:ui/Banner/.change</a></li>
<li><a href="global.html#event:choose">null.choose</a></li>
<li><a href="module-libs_Queue.html#~event:clear">module:libs/Queue.clear</a></li>
<li><a href="module-ui_Imgclip_.html#~event:clip">module:ui/Imgclip/.clip</a></li>
<li><a href="module-ui_Imgclip_.html#~event:clipend">module:ui/Imgclip/.clipend</a></li>
<li><a href="module-ui_Imgclip_.html#~event:clipstart">module:ui/Imgclip/.clipstart</a></li>
<li><a href="module-ui_Msg_.html#~event:close">module:ui/Window/.close</a></li>
<li><a href="module-libs_Queue.html#~event:done">module:libs/Queue.done</a></li>
<li><a href="module-ui_Scroll_.html#~event:down">module:ui/Scroll/.down</a></li>
<li><a href="module-core_event_drag.html#~event:drag">module:core/event/drag.drag</a></li>
<li><a href="module-libs_Animation.html#~event:end">module:libs/Animation.end</a></li>
<li><a href="module-ui_Scrollspy_.html#~event:enterviewport">module:ui/Scrollspy/.enterviewport</a></li>
<li><a href="module-ui_Viewer_.html#~event:error">module:ui/Imgclip/.error</a></li>
<li><a href="module-ui_Dialog_.html#~event:esc">module:ui/Mask/.esc</a></li>
<li><a href="module-ui_.html#~event:getoptions">module:ui/.getoptions</a></li>
<li><a href="module-ui_Mask_.html#~event:hit">module:ui/Mask/.hit</a></li>
<li><a href="module-ui_Dialog_.html#~event:hitbg">module:ui/Dialog/.hitbg</a></li>
<li><a href="module-ui_Scrollspy_.html#~event:leaveviewport">module:ui/Scrollspy/.leaveviewport</a></li>
<li><a href="module-ui_Dialog_.html#~event:open">module:ui/Window/.open</a></li>
<li><a href="module-libs_Queue.html#~event:pause">module:libs/Queue.pause</a></li>
<li><a href="module-ui_Scroll_.html#~event:pull">module:ui/Scroll/.pull</a></li>
<li><a href="module-libs_Queue.html#~event:push">module:libs/Queue.push</a></li>
<li><a href="module-ui_Mask_.html#~event:resize">module:ui/Mask/.resize</a></li>
<li><a href="module-ui_Resize_.html#~event:resizeend">module:ui/Resize/.resizeend</a></li>
<li><a href="module-ui_Resize_.html#~event:resizestart">module:ui/Resize/.resizestart</a></li>
<li><a href="module-ui_Scrollbar_.html#~event:scrollx">module:ui/Scrollbar/.scrollx</a></li>
<li><a href="module-ui_Scrollbar_.html#~event:scrolly">module:ui/Scrollbar/.scrolly</a></li>
<li><a href="module-ui_.html#~event:setoptions">module:ui/.setoptions</a></li>
<li><a href="module-libs_Queue.html#~event:shift">module:libs/Queue.shift</a></li>
<li><a href="module-libs_Queue.html#~event:size">module:libs/Queue.size</a></li>
<li><a href="module-libs_Animation.html#~event:start">module:libs/Animation.start</a></li>
<li><a href="module-libs_Queue.html#~event:step">module:libs/Queue.step</a></li>
<li><a href="module-libs_Queue.html#~event:stop">module:libs/Queue.stop</a></li>
<li><a href="module-ui_Scroll_.html#~event:top">module:ui/Scroll/.top</a></li>
<li><a href="module-ui_Scroll_.html#~event:up">module:ui/Scroll/.up</a></li>
<li><a href="global.html#event:upload">null.upload</a></li>
<li><a href="module-libs_Validator.html#~event:validateallend">module:libs/Validator.validateallend</a></li>
<li><a href="module-libs_Validator.html#~event:validateallstart">module:libs/Validator.validateallstart</a></li>
<li><a href="module-libs_Validator.html#~event:validateend">module:libs/Validator.validateend</a></li>
<li><a href="module-libs_Validator.html#~event:validateoneend">module:libs/Validator.validateoneend</a></li>
<li><a href="module-libs_Validator.html#~event:validateonestart">module:libs/Validator.validateonestart</a></li>
<li><a href="module-ui_Scroll_.html#~event:x">module:ui/Scroll/.x</a></li>
<li><a href="module-ui_Scroll_.html#~event:y">module:ui/Scroll/.y</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="nav-header">Methods</li>
<li><a href="global.html#close">close</a></li>
<li><a href="global.html#destroy">destroy</a></li>
<li><a href="global.html#open">open</a></li>
<li><a href="global.html#upload">upload</a></li>
</ul>
</li>
</ul>

			<ul class="nav navbar-nav navbar-right">
                <li><a href="/">Alien home</a></li>
            </ul>
	    </nav>
  </div>
</div>


<div id="main">


	

	    <div class="main">
	        <nav id="docs-sidebar">
	            

	            <ul class="nav sidebar-list">
	                

	                

	                
	                    <li class="sidebar-header">Events &times; 82</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:bottom">bottom</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:bottom">bottom</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:bottom">bottom</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#event:cancel">cancel</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#event:cancel">cancel</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:change">change</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#event:choose">choose</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clear">clear</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clip">clip</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clip">clip</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clip">clip</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clipend">clipend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clipend">clipend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clipend">clipend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clipstart">clipstart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clipstart">clipstart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:clipstart">clipstart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:close">close</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:close">close</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:close">close</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:close">close</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:done">done</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:done">done</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:done">done</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:done">done</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:done">done</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:down">down</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:drag">drag</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:end">end</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:enterviewport">enterviewport</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:error">error</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:error">error</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:esc">esc</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:esc">esc</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:getoptions">getoptions</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:hit">hit</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:hitbg">hitbg</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:leaveviewport">leaveviewport</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:open">open</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:open">open</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:open">open</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:open">open</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:open">open</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:pause">pause</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:pull">pull</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:push">push</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:push">push</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:resize">resize</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:resize">resize</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:resizeend">resizeend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:resizestart">resizestart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:scrollx">scrollx</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:scrollx">scrollx</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:scrolly">scrolly</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:scrolly">scrolly</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:setoptions">setoptions</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:shift">shift</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:size">size</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:start">start</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:step">step</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:stop">stop</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:top">top</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:up">up</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#event:upload">upload</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateallend">validateallend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateallstart">validateallstart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateend">validateend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateend">validateend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateoneend">validateoneend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateoneend">validateoneend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateoneend">validateoneend</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateonestart">validateonestart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:validateonestart">validateonestart</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:x">x</a>
    
</li>

	                    
	                        

<li class="">
    
        <a class="" href="#~event:y">y</a>
    
</li>

	                    
	                

	                
	            </ul>
	        </nav>

	        <section id="docs-content">
	            <div class="content">
		            <h1 class="page-title">Source: libs/Template.js</h1>

		            


    

<pre class="prettyprint source"><code>/*!
 * Template.js
 * @author ydr.me
 * @create 2014-10-09 18:35
 * @2015年05月03日00:07:41 增加 {{ignore}}...{{/ignore}} 忽略 parse 区间
 */


define(function (require, exports, module) {
    /**
     * @module libs/Template
     * @requires utils/dato
     * @requires utils/typeis
     * @requires utils/random
     * @requires utils/class
     */
    'use strict';

    var dato = require('../utils/dato.js');
    var string = require('../utils/string.js');
    var typeis = require('../utils/typeis.js');
    var random = require('../utils/random.js');
    var klass = require('../utils/class.js');
    var REG_STRING_WRAP = /([\\"])/g;
    var REG_LINES = /[\n\r\t]/g;
    var REG_SPACES = /\s{2,}/g;
    var REG_PRES = /&lt;pre\b.*?>[\s\S]*?&lt;\/pre>/ig;
    var REG_VAR = /^(=)?\s*([^|]+?)(\|.*)?$/;
    var REG_FILTER = /^(.*?)(\s*:\s*(.+)\s*)?$/;
    var REG_IF = /^((else\s+)?if)\s+(.*)$/;
    //var REH_LIST = /^list\s+\b([^,]*)\b\s+as\s+\b([^,]*)\b(\s*,\s*\b([^,]*))?$/;
    var REH_LIST = /^list\s+([^,]*)\s+as\s+([^,]*)(\s*,\s*([^,]*))?$/;
    var REG_ELSE_IF = /^else\s+if\s/;
    var REG_HASH = /^#/;
    var REG_IGNORE = /\{\{ignore}}([\s\S]*?)\{\{\/ignore}}/ig;
    var regLines = [{
        'n': /\n/g,
        'r': /\r/g,
        't': /\t/g
    }];
    var openTag = '{{';
    var closeTag = '}}';
    var configs = {
        /**
         * 是否压缩输出内容
         * @type Boolean
         */
        compress: true,
        /**
         * 是否 debug 模式
         * @type Boolean
         */
        debug: false
    };
    var filters = {};
    var Template = klass.create({
        constructor: function (template, options) {
            this._options = dato.extend(true, {}, configs, options);
            this._init(String(template));
        },

        /**
         * 生成一个变量
         * @returns {string}
         * @private
         */
        _generatorVar: function () {
            return 'alien_libs_template_' + random.string(20, '0aA');
        },


        /**
         * 初始化一个模板引擎
         * @param {String} template 模板字符串
         * @returns {Template}
         * @private
         */
        _init: function (template) {
            var the = this;
            var _var = the._generatorVar();
            var fnStr = 'var ' + _var + '="";';
            var output = [];
            var parseTimes = 0;
            // 是否进入忽略状态，true=进入，false=退出
            var inIgnore = false;
            // 是否进入表达式
            var inExp = false;

            the._template = {
                escape: string.escapeHTML,
                filters: {}
            };
            the._useFilters = {};

            the._placeholders = {};

            template.replace(REG_IGNORE, function ($0, $1) {
                var key = _generateKey();

                the._placeholders[key] = $1;

                return key;
            }).split(openTag).forEach(function (value, times) {
                var array = value.split(closeTag);
                var $0 = array[0];
                var $1 = array[1];
                var parseVar;
                var isEndIgnore;

                parseTimes++;

                // 1个开始符
                if (array.length === 1) {
                    // 多个连续开始符号
                    if (!$0 || $0 === '{') {
                        if (inIgnore) {
                            output.push(_var + '+=' + _cleanPice(openTag) + ';');
                        }
                    }
                    // 忽略开始
                    else if ($0.slice(-1) === '\\') {
                        output.push(_var + '+=' + _cleanPice($0.slice(0, -1) + openTag) + ';');
                        inIgnore = true;
                        parseTimes--;
                    }
                    else {
                        if ((parseTimes % 2) === 0) {
                            throw new Error('find unclose tag ' + openTag);
                        }

                        inIgnore = false;
                        inExp = true;
                        output.push(_var + '+=' + _cleanPice($0) + ';');
                    }
                }
                // 1个结束符
                else if (array.length === 2) {
                    $0 = $0.trim();
                    inExp = false;
                    isEndIgnore = $1.slice(-1) === '\\';

                    // 忽略结束
                    if (inIgnore) {
                        output.push(
                            _var +
                            '+=' + _cleanPice((times > 1 ? openTag : '') +
                                $0 + closeTag +
                                (isEndIgnore ? $1.slice(0, -1) : $1)
                            ) +
                            ';');
                        inIgnore = false;

                        // 下一次忽略
                        if (isEndIgnore) {
                            inIgnore = true;
                            parseTimes--;
                        }

                        return;
                    }

                    // 下一次忽略
                    if (isEndIgnore) {
                        inIgnore = true;
                        parseTimes--;
                        $1 = $1.slice(0, -1);
                    }

                    $1 = _cleanPice($1);

                    // if abc
                    if (the._hasPrefix($0, 'if')) {
                        output.push(the._parseIfAndElseIf($0) + _var + '+=' + $1 + ';');
                    }
                    // else if abc
                    else if (REG_ELSE_IF.test($0)) {
                        output.push('}' + the._parseIfAndElseIf($0) + _var + '+=' + $1 + ';');
                    }
                    // else
                    else if ($0 === 'else') {
                        output.push('}else{' + _var + '+=' + $1 + ';');
                    }
                    // /if
                    else if ($0 === '/if') {
                        output.push('}' + _var + '+=' + $1 + ';');
                    }
                    // list list as key,val
                    // list list as val
                    else if (the._hasPrefix($0, 'list')) {
                        output.push(the._parseList($0) + _var + '+=' + $1 + ';');
                    }
                    // /list
                    else if ($0 === '/list') {
                        output.push('}, this);' + _var + '+=' + $1 + ';');
                    }
                    // var
                    else if (the._hasPrefix($0, 'var')) {
                        parseVar = the._parseVar($0);

                        if (parseVar) {
                            output.push(parseVar);
                        }
                    }
                    // #
                    else if (REG_HASH.test($0)) {
                        parseVar = the._parseVar($0.replace(REG_HASH, ''));

                        if (parseVar) {
                            output.push(parseVar);
                        }
                    }
                    // exp
                    else {
                        parseVar = the._parseExp($0);

                        if (parseVar) {
                            output.push(_var + '+=' + the._parseExp($0) + '+' + $1 + ';');
                        }
                    }

                }
                // 多个结束符
                else {
                    output.push(_var + '+=' + _cleanPice(value) + ';');
                    inExp = false;
                    inIgnore = false;
                }
            });

            fnStr += output.join('') + 'return ' + _var;
            the._fn = fnStr;

            return the;
        },


        /**
         * 判断是否包含该前缀
         * @param str
         * @param pre
         * @returns {boolean}
         * @private
         */
        _hasPrefix: function (str, pre) {
            return str.indexOf(pre + ' ') === 0;
        },


        /**
         * 渲染数据
         * @param {Object} [data] 数据
         * @returns {String} 返回渲染后的数据
         *
         * @example
         * tp.render(data);
         */
        render: function (data) {
            var the = this;
            var options = the._options;
            var _var = 'alienTemplateData_' + Date.now();
            var vars = [];
            var fn;
            var existFilters = dato.extend(true, {}, filters, the._template.filters);
            var self = dato.extend(true, {}, {
                each: dato.each,
                escape: string.escapeHTML,
                filters: existFilters,
                configs: configs
            });
            var ret;

            data = data || {};
            dato.each(data, function (key) {
                vars.push('var ' + key + '=' + _var + '["' + key + '"];');
            });

            dato.each(the._useFilters, function (filter) {
                if (!existFilters[filter]) {
                    throw new Error('can not found filter ' + filter);
                }
            });

            try {
                /* jshint evil: true */
                fn = new Function(_var, 'try{' + vars.join('') + this._fn + '}catch(err){return this.configs.debug?err.stack || message:"";}');
            } catch (err) {
                fn = function () {
                    return configs.debug ? err.stack || err.message : '';
                };
            }

            try {
                ret = fn.call(self, data);
            } catch (err) {
                ret = configs.debug ? err.stack || err.message : '';
            }


            ret = String(ret);
            ret = options.compress ? _cleanHTML(ret) : ret;

            // 恢复占位
            dato.each(the._placeholders, function (key, val) {
                ret = ret.replace(key, val);
            });

            return ret;
        },


        /**
         * 添加过滤函数，默认无任何过滤函数
         * @param {String} name 过滤函数名称
         * @param {Function} callback 过滤方法
         * @param {Boolean} [isOverride=false] 覆盖实例的过滤方法，默认为false
         *
         * @example
         * tp.addFilter('test', function(val, arg1, arg2){
         *     // code
         *     // 规范定义，第1个参数为上一步的值
         *     // 后续参数自定义个数
         * });
         */
        addFilter: function (name, callback, isOverride) {
            var instanceFilters = this._template.filters;

            if (typeis(name) !== 'string') {
                throw new Error('filter name must be a string');
            }

            // 未设置覆盖 &amp;&amp; 已经覆盖
            if (!isOverride &amp;&amp; instanceFilters[name]) {
                throw new Error('override a exist instance filter');
            }

            if (typeis(callback) !== 'function') {
                throw new Error('filter callback must be a function');
            }

            instanceFilters[name] = callback;
        },


        /**
         * 获取过滤函数
         * @param {String} [name] 过滤函数名称，name为空时返回所有过滤方法
         * @returns {Function|Object}
         *
         * @example
         * tp.getFilter();
         * // => return all filters Object
         *
         * tp.getFilter('test');
         * // => return test filter function
         */
        getFilter: function (name) {
            return typeis(name) === 'string' ?
                this._template.filters[name] :
                this._template.filters;
        },


        /**
         * 解析变量赋值
         * @param str
         * @returns {string}
         * @private
         */
        _parseVar: function (str) {
            return this._parseExp(str, 'var') + ';';
        },


        /**
         * 解析表达式
         * @param str
         * @param [pre]
         * @returns {string}
         * @private
         */
        _parseExp: function (str, pre) {
            var the = this;
            var matches = str.trim().match(REG_VAR);
            var filters;

            if (!matches) {
                return '';
            }

            var exp = matches[2];

            // name || "123"
            if (matches[3] &amp;&amp; matches[3].slice(0, 2) === '||') {
                //return ret + '?' + matches[2] + ':' + matches[3].slice(2) + ')';
                exp = '(typeof(' + exp + ')!=="undefined"&amp;&amp;!!' + exp + ')?' + exp + ':' + matches[3].slice(2);
            } else if (matches[3] &amp;&amp; matches[3].slice(0, 1) === '|') {
                filters = matches[3].split('|');
                filters.shift();
                filters.forEach(function (filter) {
                    var matches = filter.match(REG_FILTER);
                    var args;
                    var name;

                    if (!matches) {
                        throw new Error('parse error ' + filter);
                    }

                    name = matches[1];

                    the._useFilters[name] = false;

                    args = exp + (matches[3] ? ',' + matches[3] : '');
                    exp = 'this.filters.' + name + '(' + args + ')';
                });
            }

            var isEscape = matches[1] !== '=';

            if (pre) {
                return exp;
            }

            return (isEscape ? 'this.escape(' : '(') + exp + ')';
        },


        /**
         * 解析条件判断
         * @param str
         * @returns {string}
         * @private
         */
        _parseIfAndElseIf: function (str) {
            var matches = str.trim().match(REG_IF);

            if (!matches) {
                throw new Error('parse error ' + str);
            }

            return matches[1] + '(' + matches[3] + '){';
        },


        /**
         * 解析列表
         * @param str
         * @returns {string}
         * @private
         */
        _parseList: function (str) {
            var matches = str.trim().match(REH_LIST);
            var parse;
            var randomKey1 = this._generatorVar();
            var randomKey2 = this._generatorVar();
            var randomVal = this._generatorVar();

            if (!matches) {
                throw new Error('parse error ' + str);
            }

            parse = {
                list: matches[1] || '',
                key: matches[4] ? matches[2] : randomKey2,
                val: matches[4] ? matches[4] : matches[2]
            };

            return 'this.each(' + parse.list + ', function(' + randomKey1 + ', ' + randomVal + '){' +
                'var ' + parse.key + ' = ' + randomKey1 + ';' +
                'var ' + parse.val + '=' + randomVal + ';';
        }
    });


    /**
     * 片段处理
     * @param str
     * @returns {string}
     * @private
     */
    function _cleanPice(str) {
        str = str
            .replace(REG_STRING_WRAP, '\\$1');

        dato.each(regLines, function (index, map) {
            var key = Object.keys(map)[0];
            var val = map[key];

            str = str.replace(val, '\\' + key);
        });

        return '"' + str + '"';
    }


    /**
     * 生成随机 42 位的 KEY
     * @returns {string}
     * @private
     */
    function _generateKey() {
        return 'œ' + random.string(40, 'aA0') + 'œ';
    }


    /**
     * 清理 HTML
     * @param code
     * @private
     */
    function _cleanHTML(code) {
        // 保存 &lt;pre>
        var preMap = {};

        code = code.replace(REG_PRES, function ($0) {
            var key = _generateKey();

            preMap[key] = $0;

            return key;
        });


        code = code
            .replace(REG_LINES, '')
            .replace(REG_SPACES, ' ');


        dato.each(preMap, function (key, val) {
            code = code.replace(key, val);
        });

        return code;
    }


    /**
     * 默认配置
     * @type {Object}
     * @static
     */
    Template.configs = configs;


    /**
     * 静态过滤方法
     * @type {Object}
     * @static
     */
    Template.filters = filters;

    /**
     * 设置默认配置
     * @param options
     */
    Template.config = function (options) {
        dato.extend(configs, options);
    };


    /**
     * 添加过滤方法
     * @param {String} name 过滤方法名称
     * @param {Function} callback 方法
     * @param {Boolean} [isOverride=false] 是否强制覆盖，默认 false
     * @static
     */
    Template.addFilter = function (name, callback, isOverride) {
        if (typeis(name) !== 'string') {
            throw new Error('filter name must be a string');
        }

        // 未设置覆盖 &amp;&amp; 已经覆盖
        if (!isOverride &amp;&amp; filters[name]) {
            throw new Error('override a exist filter');
        }

        if (typeis(callback) !== 'function') {
            throw new Error('filter callback must be a function');
        }

        filters[name] = callback;
    };


    /**
     * 获取过滤方法
     * @param {String} [name] 获取过滤方法的名称，为空表示获取全部过滤方法
     * @returns {Function|Object} 放回过滤方法或过滤方法的集合
     * @static
     */
    Template.getFilter = function (name) {
        if (!name) {
            return filters;
        }

        if (typeis(name) === 'string') {
            return filters[name];
        }
    };


    /**
     * 模板引擎
     *
     * @param {Object} [options] 配置
     * @param {Boolean} [options.cache=true] 是否缓存上次结果
     * @param {Boolean} [options.compress=true] 是否输出压缩内容
     * @param {Boolean} [options.debug=false] 是否输出调试新
     * @constructor
     *
     * @example
     * var tpl = new Template('{{name}}');
     * tpl.render({name: 'yundanran'});
     * // => 'yundanran'
     */
    module.exports = Template;
});
</code></pre>






	            </div>
	        </section>
	    </div>

    


</div>

<script src="/static/js/jquery.1.10.min.js"> </script>
<script src="/static/js/prettify/prettify.js"> </script>
<script src="/static/js/prettify/lang-css.js"> </script>
<script> prettyPrint(); </script>
<script src="/static/js/linenumber.js"> </script>
<script src="/static/js/bootstrap.js"> </script>
<script src="/static/js/script.js"> </script>

</body>
</html>
