<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Source: util/dato.js - Alien documents</title>

    <link type="text/css" rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
    <link type="text/css" rel="stylesheet" href="/static/styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="/static/css/docs.css">
</head>

<body>


<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
	    <div class="navbar-header">
	        <a class="navbar-brand" href="index.html">Alien documents</a>
	    </div>
	    <nav role="navigation">
			<ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="module-core_communication_jsonp.html">core/communication/jsonp</a></li>
<li><a href="module-core_communication_upload.html">core/communication/upload</a></li>
<li><a href="module-core_communication_xhr.html">core/communication/xhr</a></li>
<li><a href="module-core_dom_animation.html">core/dom/animation</a></li>
<li><a href="module-core_dom_attribute.html">core/dom/attribute</a></li>
<li><a href="module-core_dom_canvas.html">core/dom/canvas</a></li>
<li><a href="module-core_dom_modification.html">core/dom/modification</a></li>
<li><a href="module-core_dom_see.html">core/dom/see</a></li>
<li><a href="module-core_dom_selector.html">core/dom/selector</a></li>
<li><a href="module-core_event_base.html">core/event/base</a></li>
<li><a href="module-core_event_drag.html">core/event/drag</a></li>
<li><a href="module-core_event_ready.html">core/event/ready</a></li>
<li><a href="module-core_event_touch.html">core/event/touch</a></li>
<li><a href="module-core_event_wheel.html">core/event/wheel</a></li>
<li><a href="module-core_navigator_compatible.html">core/navigator/compatible</a></li>
<li><a href="module-core_navigator_cookie.html">core/navigator/cookie</a></li>
<li><a href="module-core_navigator_hashbang.html">core/navigator/hashbang</a></li>
<li><a href="module-core_navigator_querystring.html">core/navigator/querystring</a></li>
<li><a href="module-core_navigator_shell.html">core/navigator/shell</a></li>
<li><a href="module-core_navigator_storage.html">core/navigator/storage</a></li>
<li><a href="module-core_navigator_ua.html">core/navigator/ua</a></li>
<li><a href="module-libs_Animation.html">libs/Animation</a></li>
<li><a href="module-libs_Autoheight_.html">libs/Autoheight/</a></li>
<li><a href="module-libs_Emitter.html">libs/Emitter</a></li>
<li><a href="module-libs_Pagination.html">libs/Pagination</a></li>
<li><a href="module-libs_Pjax.html">libs/Pjax</a></li>
<li><a href="module-libs_Template.html">libs/Template</a></li>
<li><a href="module-libs_Validator.html">libs/Validator</a></li>
<li><a href="module-parent_getset.html">parent/getset</a></li>
<li><a href="module-parent_index.html">parent/index</a></li>
<li><a href="module-parent_keyframes.html">parent/keyframes</a></li>
<li><a href="module-ui_Banner_.html">ui/Banner/</a></li>
<li><a href="module-ui_base.html">ui/base</a></li>
<li><a href="module-ui_Dialog_.html">ui/Dialog/</a></li>
<li><a href="module-ui_Editor_.html">ui/Editor/</a></li>
<li><a href="module-ui_Editor_editor.html">ui/Editor/editor</a></li>
<li><a href="module-ui_Imgclip_.html">ui/Imgclip/</a></li>
<li><a href="module-ui_Mask_.html">ui/Mask/</a></li>
<li><a href="module-ui_Pager_.html">ui/Pager/</a></li>
<li><a href="module-ui_Pagination_.html">ui/Pagination/</a></li>
<li><a href="module-ui_Prettify_.html">ui/Prettify/</a></li>
<li><a href="module-ui_Resize_.html">ui/Resize/</a></li>
<li><a href="module-ui_Scrollbar_.html">ui/Scrollbar/</a></li>
<li><a href="module-ui_Tab_.html">ui/Tab/</a></li>
<li><a href="module-ui_Tooltip_.html">ui/Tooltip/</a></li>
<li><a href="module-ui_Validator_.html">ui/Validator/</a></li>
<li><a href="module-ui_Viewer_.html">ui/Viewer/</a></li>
<li><a href="module-ui_Window_.html">ui/Window/</a></li>
<li><a href="module-util_calendar.html">util/calendar</a></li>
<li><a href="module-util_canvas.html">util/canvas</a></li>
<li><a href="module-util_class.html">util/class</a></li>
<li><a href="module-util_controller.html">util/controller</a></li>
<li><a href="module-util_data.html">util/data</a></li>
<li><a href="module-util_date.html">util/date</a></li>
<li><a href="module-util_easing.html">util/easing</a></li>
<li><a href="module-util_hashbang.html">util/hashbang</a></li>
<li><a href="module-util_querystring.html">util/querystring</a></li>
<li><a href="module-util_random.html">util/random</a></li>
<li><a href="module-util_selection.html">util/selection</a></li>
<li><a href="module-util_typeis.html">util/typeis</a></li>
</ul>
</li>
</ul>

			<ul class="nav navbar-nav navbar-right">
                <li><a href="/">Alien home</a></li>
            </ul>
	    </nav>
  </div>
</div>


<div id="main">


	

	    <div class="main">
	        <nav id="docs-sidebar">
	            

	            <ul class="nav sidebar-list">
	                

	                

	                

	                
	            </ul>
	        </nav>

	        <section id="docs-content">
	            <div class="content">
		            <h1 class="page-title">Source: util/dato.js</h1>

		            


    

<pre class="prettyprint source"><code>/*!
 * data-traveller.js
 * @author ydr.me
 * 2014-09-14 17:26
 */


define(function (require, exports, module) {
    /**
     * @module util/data
     * @requires util/typeis
     */

    'use strict';

    var typeis = require('./typeis.js');
    var udf;
    var canListTypeArr = 'array object nodelist htmlcollection arguments'.split(' ');
    var REG_NOT_UTF16_SINGLE = /[^\x00-\xff]{2}/g;
    var REG_STRING_FIX = /[.*+?^=!:${}()|[\]\/\\]/g;


    /**
     * 格式化数字，如果是非数字则返回默认值
     * @param {*} obj 待格式化对象
     * @param {*} [dft] 非数字时的默认值
     * @returns {*}
     */
    exports.parseInt = function (obj, dft) {
        obj = parseInt(obj, 10);

        return isNaN(obj) ? dft : obj;
    };


    /**
     * 格式化数字，如果是非数字则返回默认值
     * @param {*} obj 待格式化对象
     * @param {*} [dft] 非数字时的默认值
     * @returns {*}
     */
    exports.parseFloat = function (obj, dft) {
        obj = parseFloat(obj);

        return isNaN(obj) ? dft : obj;
    };


    /**
     * 遍历元素
     * @param {Array/Object} list  数组、可枚举对象
     * @param {Function(this:data, key, val)} callback  回调，返回false时停止遍历
     * @param {*} [context] 上下文
     *
     * @example
     * // 与 jQuery.each 一样
     * // 返回 false 时将退出当前遍历
     * data.each(list, function(key, val){});
     */
    exports.each = function (list, callback, context) {
        var i;
        var j;

        // 数组 或 类似数组
        if (list &amp;&amp; list.length !== udf) {
            for (i = 0, j = exports.parseInt(list.length, 0); i &lt; j; i++) {
                context = context || list[i];
                if (callback.call(context, i, list[i]) === false) {
                    break;
                }
            }
        }
        // 纯对象
        else if (list !== null &amp;&amp; list !== udf) {
            for (i in list) {
                if (list.hasOwnProperty(i)) {
                    context = context || list[i];
                    if (callback.call(context, i, list[i]) === false) {
                        break;
                    }
                }
            }
        }
    };


    /**
     * 扩展静态对象
     * @param {Boolean|Object} [isExtendDeep] 是否深度扩展，可省略，默认false
     * @param {Object}  [source] 源对象
     * @param {...Object}  [target] 目标对象，可以是多个
     * @returns {*}
     *
     * @example
     * // 使用方法与 jQuery.extend 一样
     * var o1 = {a: 1};
     * var o2 = {b: 2};
     * var o3 = data.extend(true, o1, o2);
     * // => {a: 1, b: 2}
     * o1 === o3
     * // => true
     *
     * // 如果不想污染原始对象，可以传递一个空对象作为容器
     * var o1 = {a: 1};
     * var o2 = {b: 2};
     * var o3 = data.extend(true, {}, o1, o2);
     * // => {a: 1, b: 2}
     * o1 === o3
     * // => fale
     */
    exports.extend = function (isExtendDeep, source, target) {
        var args = arguments;
        var firstArgIsBoolean = typeof(args[0]) === 'boolean';
        var current = firstArgIsBoolean ? 1 : 0;
        var length = args.length;
        var i;
        var obj;
        var type;

        isExtendDeep = firstArgIsBoolean &amp;&amp; args[0] === true;
        source = args[current++];

        for (; current &lt; length; current++) {
            obj = args[current];
            for (i in obj) {
                if (obj.hasOwnProperty(i) &amp;&amp; obj[i] !== undefined) {
                    type = typeis(obj[i]);
                    if (type === 'object' &amp;&amp; isExtendDeep) {
                        source[i] = source[i] || {};
                        exports.extend.call(this, isExtendDeep, source[i], obj[i]);
                    } else if (type === 'array' &amp;&amp; isExtendDeep) {
                        source[i] = source[i] || [];
                        exports.extend.call(this, isExtendDeep, source[i], obj[i]);
                    } else {
                        source[i] = obj[i];
                    }
                }
            }
        }

        return source;
    };


    /**
     * 转换对象为一个纯数组，只要对象有length属性即可
     * @param {Object} [obj] 对象
     * @param {Boolean} [isConvertWhole] 是否转换整个对象为数组中的第0个元素，当该对象无length属性时，默认false
     * @returns {Array}
     *
     * @example
     * var o = {0:"foo", 1:"bar", length: 2}
     * data.toArray(o);
     * // => ["foo", "bar"]
     *
     * var a1 = [1, 2, 3];
     * // 转换后的数组是之前的副本
     * var a2 = data.toArray(a1);
     * // => [1, 2, 3]
     * a2 === a1;
     * // => false
     */
    exports.toArray = function (obj, isConvertWhole) {
        var ret = [];
        var i = 0;
        var j;
        var objType = typeis(obj);

        if (canListTypeArr.indexOf(objType) > -1 &amp;&amp; typeis(obj.length) === 'number' &amp;&amp; obj.length >= 0) {
            for (j = obj.length; i &lt; j; i++) {
                ret.push(obj[i]);
            }
        } else if (obj &amp;&amp; isConvertWhole) {
            ret.push(obj);
        }

        return ret;
    };


    ///**
    // * 判断一个对象是否有属于自身的方法、属性，而不是原型链方法、属性以及其他继承来的方法、属性
    // * @param obj {Object} 判断对象
    // * @param prop {String} 方法、属性名称
    // * @returns {Boolean}
    // *
    // * @example
    // * var o = {a: 1};
    // * data.hasOwnProperty(o, 'a');
    // * // => true
    // */
    //exports.hasOwnProperty = function (obj, prop) {
    //    return Object.prototype.hasOwnProperty.call(obj, prop);
    //};


    /**
     * 对象1级比较，找出相同和不同的键
     * @param obj1 {Object|Array}
     * @param obj2 {Object|Array}
     * @returns {Object}
     *
     * @example
     * data.compare({a:1,b:2,c:3}, {a:1,d:4});
     * // =>
     * // {
     * //    same: ["a"],
     * //    only: [
     * //       ["b", "c"],
     * //       ["d"]
     * //    ],
     * //    different: ["b", "c", "d"]
     * // }
     */
    exports.compare = function (obj1, obj2) {
        var obj1Type = typeis(obj1);
        var obj2Type = typeis(obj2);
        var obj1Only = [];
        var obj2Only = [];
        var same = [];

        // 类型不同
        if (obj1Type !== obj2Type) {
            return null;
        }

        // 对象
        if (obj1Type === 'object' || obj1Type === 'array') {
            exports.each(obj1, function (key, val) {
                if (obj2[key] !== val) {
                    obj1Only.push(key);
                } else {
                    same.push(key);
                }
            });

            exports.each(obj2, function (key, val) {
                if (obj1[key] !== val) {
                    obj2Only.push(key);
                }
            });

            return {
                same: same,
                only: [
                    obj1Only,
                    obj2Only
                ],
                different: obj1Only.concat(obj2Only)
            };
        } else {
            return null;
        }
    };


    /**
     * 修正正则字符串
     * @param regExpString
     * @returns {String}
     *
     * @example
     * data.fixRegExp('/');
     * // => '\/'
     */
    exports.fixRegExp = function (regExpString) {
        return regExpString.replace(REG_STRING_FIX, '\\$&amp;');
    };


    /**
     * 计算字节长度
     * @param string {String} 原始字符串
     * @param [doubleLength=2] {Number} 双字节长度，默认为2
     * @returns {number}
     *
     * @example
     * data.bytes('我123');
     * // => 5
     */
    exports.bytes = function (string, doubleLength) {
        string += '';
        doubleLength = exports.parseInt(doubleLength, 2);

        var i = 0,
            j = string.length,
            k = 0,
            c;

        for (; i &lt; j; i++) {
            c = string.charCodeAt(i);
            k += (c >= 0x0001 &amp;&amp; c &lt;= 0x007e) || (0xff60 &lt;= c &amp;&amp; c &lt;= 0xff9f) ? 1 : doubleLength;
        }

        return k;
    };


    /**
     * 计算字符串长度
     * 双字节的字符使用 length 属性计算不准确
     * @ref http://es6.ruanyifeng.com/#docs/string
     * @param string {String} 原始字符串
     *
     * @example
     * var s = "𠮷";
     * s.length = 2;
     * dato.length(s);
     * // => 1
     */
    exports.length = function (string) {
        string += '';

        return string.replace(REG_NOT_UTF16_SINGLE, '*').length;
    };


    /**
     * 按长度补0填充数字
     * @param  {Number|String} number 数字
     * @param  {Number} length 长度
     * @return {String} 修复后的数字
     *
     * @example
     * fixedNumber(2, 4);
     * // => "0002"
     */
    exports.fillNumber = function (number, length) {
        var len = length;
        var start = '';

        while (len--) {
            start += '0';
        }

        return (start + number).slice(-length);
    };


    /**
     * asscii to base64
     * @param asscii
     * @returns {string}
     */
    exports.atob = function (asscii) {
        try {
            return window.atob(encodeURIComponent(String(asscii)));
        } catch (err) {
            return '';
        }
    };


    /**
     * base64 to asscii
     * @param base64
     * @returns {string}
     */
    exports.btoa = function (base64) {
        try {
            return decodeURIComponent(window.btoa(String(base64)));
        } catch (err) {
            return '';
        }
    };
});</code></pre>






	            </div>
	        </section>
	    </div>

    


</div>

<script src="/static/js/jquery.1.10.min.js"> </script>
<script src="/static/js/prettify/prettify.js"> </script>
<script src="/static/js/prettify/lang-css.js"> </script>
<script> prettyPrint(); </script>
<script src="/static/js/linenumber.js"> </script>
<script src="/static/js/bootstrap.js"> </script>
<script src="/static/js/script.js"> </script>

</body>
</html>
