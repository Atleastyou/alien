<!DOCTYPE html>
<!--
 - DDB.html
 - @author ydr.me
 - @create 2014-10-18 12:29
 -->
<html>
<head lang="zh-cn">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1.0,minimum-scale=1.0,minimal-ui">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="author" content="云淡然;http://ydr.me">
    <meta name="keywords" content="关键词1,关键词2">
    <meta name="description" content="描述语句">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <title>DDB.html</title>
    <style>
        .center {
            font-size: 40px;
            font-weight: 900;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        .abc {
            background: #dd626a;
            color: #fff;
            padding: 4px;
        }

        button {
            padding: 10px 20px;
        }

        #data,
        #temp,
        #demo {
            padding: 10px;
        }

        #data {
            background: #ecc6ae;
        }

        #temp {
            white-space: pre-wrap;
            background: #b3ecba;
        }

        #demo {
            background: #F9F7FF;
        }
    </style>
</head>
<body>

<p><b>DOM:</b></p>

<div id="temp"></div>
<p class="center">+</p>

<p><b>DATA:</b></p>

<div id="data"></div>
<p class="center">
    <button id="btn">=</button>
</p>
<p><b>BINDING:</b></p>

<div id="demo">
    <input type="text" al-value="name"/>

    <p al-class="{abc: name==='云淡然'}">hi, <b al-html="name"></b>，你的第一个爱好为<em al-html="love[0]"></em></p>
    <ul al-style="{fontSize: love.length * 6+'px'}">
        <li al-repeat="index,val in love">
            <span al-html="index + 1"></span>
            <span al-html="name + ' love ' + val"></span>
        </li>
    </ul>
</div>
<hr/>
<button id="btn2" disabled>随机改变love[0]</button>
<button id="btn3" disabled>随机位置插入love元素</button>
<button id="btn4" disabled>随机位置删除love元素</button>

<script src="/seajs/sea.js" id="script"></script>
<script>
    define('app', function (require) {
        var DDB = require('/src/libs/DDB.js');
        var data = {
            name: '云淡然',
            love: ['前端开发', '睡觉', '听歌']
        };
        var $data = document.getElementById('data');
        var $demo = document.getElementById('demo');
        var $btn = document.getElementById('btn');
        var $btn2 = document.getElementById('btn2');
        var $btn3 = document.getElementById('btn3');
        var $btn4 = document.getElementById('btn4');
        var ddb;

        $data.innerHTML = JSON.stringify(data);
        document.getElementById('temp').innerText = $demo.innerHTML.trim();

        $btn.onclick = function () {
            this.disabled = true;
            $btn2.disabled = false;
            $btn3.disabled = false;
            $btn4.disabled = false;

            // 实例化一个DDB（DOM-DATA-BINDING）
            ddb = new DDB($demo, data);
            window.ddb = ddb;

            // 数据发生变化回调
            ddb.on('change', function (data) {
                $data.innerHTML = JSON.stringify(data);
            });
        };

        $btn2.onclick = function () {
            // 手动更新数据
            ddb.update(function (data, next) {
                data.love[0] = '随机爱好' + String(Math.random()).slice(2);
                next();
            });
        };

        $btn3.onclick = function () {
            // 手动更新数据
            ddb.update(function (data, next) {
                var max = data.love.length;
                var pos = _random(0, max);

                data.love.splice(pos, 0, '>随机爱好<' + String(Math.random()).slice(2));
                next();
            });
        };

        $btn4.onclick = function () {
            // 手动更新数据
            ddb.update(function (data, next) {
                var max = data.love.length;
                var pos;

                if (max > 0) {
                    pos = _random(0, max);
                    data.love.splice(pos, 1);
                }

                next();
            });
        };


        /**
         * 随机数
         * @param min
         * @param max
         * @returns {number|*}
         * @private
         */
        function _random(min, max) {
            return Math.floor(Math.random() * (max - 1) + min);
        }
    });
    seajs.use('app');
</script>
</body>
</html>