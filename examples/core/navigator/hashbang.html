<!DOCTYPE html>
<!--
 - hashbang.html
 - @author ydr.me
 - 2014-09-24 15:04
 -->
<html>
<head lang="zh-cn">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1.0,minimum-scale=1.0,minimal-ui">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="author" content="云淡然;http://ydr.me">
    <meta name="keywords" content="关键词1,关键词2">
    <meta name="description" content="描述语句">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <title>hashbang.html</title>
</head>
<body>

<ul>
    <li>路由1：/index/</li>
    <li>路由2：/user/:userId/</li>
</ul>

<button id="btn1">设置为 #!/index/</button><br>
<button id="btn2">设置为 #!/user/:userId/</button><br>
<button id="btn3">设置为 #!/dmin/:adminId/page/:pageNo</button><br>
<div>监听结果：
    <p id="ret"></p>
</div>

<script src="/seajs/sea.js" id="script"></script>
<script>
    define('app', function (require) {
        var hashbang = require('/src/util/hashbang.js');
        var data = require('/src/util/data.js');
        var ret = document.getElementById('ret');
        var routes = [
            '/index/',
            '/user/:userId/'
        ]

        document.getElementById('btn1').onclick = function () {
            var hash = hashbang.stringify({
                path: '/index/'
            });

            location.hash = hash;
        }

        document.getElementById('btn2').onclick = function () {
            var hash = hashbang.stringify({
                path: '/user/'+ Date.now()
            });

            location.hash = hash;
        }

        document.getElementById('btn3').onclick = function () {
            var hash = hashbang.stringify({
                path: ['admin', Date.now(), 'page', Date.now()]
            });

            location.hash = hash;
        }

        window.hashbang = hashbang;

        hashbang.on('path', 0, function (eve, newObject, oldObject) {
            console.log('path: 0');
            console.log(newObject);
            console.log(oldObject);
        });

        hashbang.on('query', ['b', 'c'], function (eve, newObject, oldObject) {
            console.log('query: [b c]');
            console.log(newObject);
            console.log(oldObject);
        });

        hashbang.on('path', -1, function (eve, newObject, oldObject) {
            var matched;

            data.each(routes, function (index, route) {
                matched = hashbang.matches(eve.newURL, route);
                if(matched){
                    return !1;
                }
            });

            ret.innerHTML = JSON.stringify(matched);
        });
    });
    seajs.use('app');
</script>


</body>
</html>